const data =  {
    "base_info": { 
        "zhen": { 
            "province": "北京市",  
            "city": "北京",       
            "jingdu": "116.46",  
            "weidu": "39.92",    
            "shicha": "晚0小时14分10秒" 
            },
      "sex": "坤造", 
      "name": "缘主", 
      "gongli": "1988年11月8日12时20分", 
      "nongli": "戊辰年 九月 廿九日 午时", 
      "qiyun": "9年6月26天起运",         
      "jiaoyun": "1998年4月16日16时52分1秒" 
    },
    "bazi_info": {   
      "kw": "戌亥",   
      "tg_cg_god": [ 
        "伤官",
        "七杀",
        "日元",
        "劫财"
      ],
      "bazi": [  
        "戊辰",   
        "癸亥",   
        "丁卯",   
        "丙午"    
      ],
      "dz_cg": [ 
        "戊|乙|癸", 
        "壬|甲",     
        "乙",       
        "丁|己"      
      ],
      "dz_cg_god": [ 
        "伤官|偏印|七杀",    
        "正官|正印",      
        "偏印",        
        "比劫|食神"       
      ],
      "day_cs": [   
        "衰",       
        "胎",       
        "病",       
        "临官"      
      ],
      "na_yin": [    
        "大林木",     
        "大海水",     
        "炉中火",     
        "天河水"      
      ]
    },
    "dayun_info": { 
      "big_god": [  
        "正印",
        "偏印",
        "劫财",
        "比肩",
        "伤官",
        "食神",
        "偏财",
        "正财",
        "正官",
        "七杀",
        "正印",
        "偏印"
      ],
      "big": [   
        "甲子",
        "乙丑",
        "丙寅",
        "丁卯",
        "戊辰",
        "己巳",
        "庚午",
        "辛未",
        "壬申",
        "癸酉",
        "甲戌",
        "乙亥"
      ],
      "big_cs": [ 
        "绝",
        "墓",
        "死",
        "病",
        "衰",
        "帝旺",
        "临官",
        "冠带",
        "沐浴",
        "长生",
        "养",
        "胎"
      ],
      "xu_sui": [ 
        11,
        21,
        31,
        41,
        51,
        61,
        71,
        81,
        91,
        101,
        111,
        121
      ],
      "big_start_year": [ 
        1998,
        2008,
        2018,
        2028,
        2038,
        2048,
        2058,
        2068,
        2078,
        2088,
        2098,
        2108
      ],
      "big_start_year_liu_nian": "", 
      "big_end_year": [ 
        2007,
        2017,
        2027,
        2037,
        2047,
        2057,
        2067,
        2077,
        2087,
        2097,
        2107,
        2117
      ],
      "years_info0": [  
        {
          "year_char": "戊寅"
        },
        {
          "year_char": "戊子"
        },
        {
          "year_char": "戊戌"
        },
        {
          "year_char": "戊申"
        },
        {
          "year_char": "戊午"
        },
        {
          "year_char": "戊辰"
        },
        {
          "year_char": "戊寅"
        },
        {
          "year_char": "戊子"
        },
        {
          "year_char": "戊戌"
        },
        {
          "year_char": "戊申"
        },
        {
          "year_char": "戊午"
        },
        {
          "year_char": "戊辰"
        }
      ],
      "years_info1": [ 
        {
          "year_char": "己卯"
        },
        {
          "year_char": "己丑"
        },
        {
          "year_char": "己亥"
        },
        {
          "year_char": "己酉"
        },
        {
          "year_char": "己未"
        },
        {
          "year_char": "己巳"
        },
        {
          "year_char": "己卯"
        },
        {
          "year_char": "己丑"
        },
        {
          "year_char": "己亥"
        },
        {
          "year_char": "己酉"
        },
        {
          "year_char": "己未"
        },
        {
          "year_char": "己巳"
        }
      ],
      "years_info2": [ 
        {
          "year_char": "庚辰"
        },
        {
          "year_char": "庚寅"
        },
        {
          "year_char": "庚子"
        },
        {
          "year_char": "庚戌"
        },
        {
          "year_char": "庚申"
        },
        {
          "year_char": "庚午"
        },
        {
          "year_char": "庚辰"
        },
        {
          "year_char": "庚寅"
        },
        {
          "year_char": "庚子"
        },
        {
          "year_char": "庚戌"
        },
        {
          "year_char": "庚申"
        },
        {
          "year_char": "庚午"
        }
      ],
      "years_info3": [ 
        {
          "year_char": "辛巳"
        },
        {
          "year_char": "辛卯"
        },
        {
          "year_char": "辛丑"
        },
        {
          "year_char": "辛亥"
        },
        {
          "year_char": "辛酉"
        },
        {
          "year_char": "辛未"
        },
        {
          "year_char": "辛巳"
        },
        {
          "year_char": "辛卯"
        },
        {
          "year_char": "辛丑"
        },
        {
          "year_char": "辛亥"
        },
        {
          "year_char": "辛酉"
        },
        {
          "year_char": "辛未"
        }
      ],
      "years_info4": [ 
        {
          "year_char": "壬午"
        },
        {
          "year_char": "壬辰"
        },
        {
          "year_char": "壬寅"
        },
        {
          "year_char": "壬子"
        },
        {
          "year_char": "壬戌"
        },
        {
          "year_char": "壬申"
        },
        {
          "year_char": "壬午"
        },
        {
          "year_char": "壬辰"
        },
        {
          "year_char": "壬寅"
        },
        {
          "year_char": "壬子"
        },
        {
          "year_char": "壬戌"
        },
        {
          "year_char": "壬申"
        }
      ],
      "years_info5": [ 
        {
          "year_char": "癸未"
        },
        {
          "year_char": "癸巳"
        },
        {
          "year_char": "癸卯"
        },
        {
          "year_char": "癸丑"
        },
        {
          "year_char": "癸亥"
        },
        {
          "year_char": "癸酉"
        },
        {
          "year_char": "癸未"
        },
        {
          "year_char": "癸巳"
        },
        {
          "year_char": "癸卯"
        },
        {
          "year_char": "癸丑"
        },
        {
          "year_char": "癸亥"
        },
        {
          "year_char": "癸酉"
        }
      ],
      "years_info6": [ 
        {
          "year_char": "甲申"
        },
        {
          "year_char": "甲午"
        },
        {
          "year_char": "甲辰"
        },
        {
          "year_char": "甲寅"
        },
        {
          "year_char": "甲子"
        },
        {
          "year_char": "甲戌"
        },
        {
          "year_char": "甲申"
        },
        {
          "year_char": "甲午"
        },
        {
          "year_char": "甲辰"
        },
        {
          "year_char": "甲寅"
        },
        {
          "year_char": "甲子"
        },
        {
          "year_char": "甲戌"
        }
      ],
      "years_info7": [ 
        {
          "year_char": "乙酉"
        },
        {
          "year_char": "乙未"
        },
        {
          "year_char": "乙巳"
        },
        {
          "year_char": "乙卯"
        },
        {
          "year_char": "乙丑"
        },
        {
          "year_char": "乙亥"
        },
        {
          "year_char": "乙酉"
        },
        {
          "year_char": "乙未"
        },
        {
          "year_char": "乙巳"
        },
        {
          "year_char": "乙卯"
        },
        {
          "year_char": "乙丑"
        },
        {
          "year_char": "乙亥"
        }
      ],
      "years_info8": [ 
        {
          "year_char": "丙戌"
        },
        {
          "year_char": "丙申"
        },
        {
          "year_char": "丙午"
        },
        {
          "year_char": "丙辰"
        },
        {
          "year_char": "丙寅"
        },
        {
          "year_char": "丙子"
        },
        {
          "year_char": "丙戌"
        },
        {
          "year_char": "丙申"
        },
        {
          "year_char": "丙午"
        },
        {
          "year_char": "丙辰"
        },
        {
          "year_char": "丙寅"
        },
        {
          "year_char": "丙子"
        }
      ],
      "years_info9": [ 
        {
          "year_char": "丁亥"
        },
        {
          "year_char": "丁酉"
        },
        {
          "year_char": "丁未"
        },
        {
          "year_char": "丁巳"
        },
        {
          "year_char": "丁卯"
        },
        {
          "year_char": "丁丑"
        },
        {
          "year_char": "丁亥"
        },
        {
          "year_char": "丁酉"
        },
        {
          "year_char": "丁未"
        },
        {
          "year_char": "丁巳"
        },
        {
          "year_char": "丁卯"
        },
        {
          "year_char": "丁丑"
        }
      ]
    },
    "start_info": {
      "jishen": [  
        "太极",     
        "空亡 福星 学堂 亡神 元辰(大耗) 红鸾",  
        "太极 六厄",             
        "禄神 天厨 灾煞 干禄"      
      ],
      "xz": "天蝎座",      
      "sx": "龙"          
    },
     "detail_info": {   
      "zhuxing": {      
        "year": "伤官",  
        "month": "比肩", 
        "day": "日元",   
        "hour": "食神"   
      },
      "sizhu": {        
        "year": {
          "tg": "己",    
          "dz": "巳"     
        },
        "month": {
          "tg": "丙",    
          "dz": "子"     
        },
        "day": {
          "tg": "丙",    
          "dz": "寅"     
        },
        "hour": {
          "tg": "戊",    
          "dz": "子"     
        }
      },
      "canggan": {      
        "year": [       
          "丙",
          "戊",
          "庚"
        ],
        "month": [      
          "癸"
        ],
        "day": [        
          "甲",
          "丙",
          "戊"
        ],
        "hour": [       
          "癸"
        ]
      },
      "fuxing": {       
        "year": [       
          "比肩",
          "食神",
          "正财"
        ],
        "month": [      
          "正官"
        ],
        "day": [        
          "偏印",
          "比肩",
          "食神"
        ],
        "hour": [       
          "正官"
        ]
      },
      "xingyun": {      
        "year": "临官",  
        "month": "胎",   
        "day": "长生",   
        "hour": "胎"     
      },
      "zizuo": {        
        "year": "帝旺",  
        "month": "胎",   
        "day": "长生",   
        "hour": "胎"     
      },
      "kongwang": {     
        "year": "戌亥",   
        "month": "申酉",  
        "day": "戌亥",    
        "hour": "午未"    
      },
      "nayin": {          
        "year": "大林木",   
        "month": "涧下水",  
        "day": "炉中火",    
        "hour": "霹雳火"    
      },
      "shensha": {      
        "year": "天德 禄神 亡神 干禄",     
        "month": "天乙 福星 天厨 六厄",    
        "day": "福星 国印 红艳 劫煞 词馆",  
        "hour": "天乙 福星 天厨 六厄"       
      },
      "dayunshensha": [     
        {
          "tgdz": "戊辰",     
          "shensha": "太极 "  
        },
        {
          "tgdz": "丁卯",     
          "shensha": "太极 月德 桃花 "    
        },
        {
          "tgdz": "丙寅",
          "shensha": "福星 红艳 "
        },
        {
          "tgdz": "乙丑",
          "shensha": "福星 国印 "
        },
        {
          "tgdz": "甲子",
          "shensha": "太极 福星 天厨 "
        },
        {
          "tgdz": "癸亥",
          "shensha": "空亡 天医 天厨 劫煞 "
        },
        {
          "tgdz": "壬戌",
          "shensha": "空亡 华盖 "
        },
        {
          "tgdz": "辛酉",
          "shensha": "太极 "
        },
        {
          "tgdz": "庚申",
          "shensha": "文昌 驿马 "
        },
        {
          "tgdz": "己未",
          "shensha": "太极 金舆 福星 流霞 "
        },
        {
          "tgdz": "戊午",
          "shensha": "羊刃 天厨 将星 "
        },
        {
          "tgdz": "丁巳", 
          "shensha": "天德 月德 禄神 天厨 亡神 干禄 " 
        }
      ]} }

document.addEventListener('DOMContentLoaded', function() {
    const baseInfo = data.base_info;
    const bazi_info = data.bazi_info;
    const startInfo = data.start_info;  

        // 基本信息
        const base_fields = {
            sex: "性别: ",
            name: "姓名: ",
            gongli: "",
            nongli: "",
            qiyun: "",
            jiaoyun: "交运: "
        };
        Object.entries(base_fields).forEach(([key, label]) => {
            const value = data.base_info[key];
            document.getElementById(key).textContent = `${label}${value}`;
        });


        // 八字信息
        const bazi_Fields = {
          tg_cg_god: "干神",
          bazi: "干支",
          dz_cg: "藏干",
          dz_cg_god: "支神",
          day_cs: "地势",
          na_yin: "纳音",
          jishen:"神煞"
        };

        const baziTable = document.getElementById('baziInfoTable');
        Object.entries(bazi_Fields).forEach(([key, label]) => {
            const row = baziTable.insertRow();
            const headerCell = row.insertCell();
            headerCell.textContent = label; // 使用中文标签

          if (key === 'jishen') { // 特殊处理神煞
            ['year', 'month', 'day', 'hour'].forEach(time => {
                const cell = row.insertCell();
                cell.classList.add('center');

                const timeIndex = { year: 0, month: 1, day: 2, hour: 3 }[time];
                const items = startInfo.jishen[timeIndex]; 

                items.split(' ').forEach(item => {
                    if (item) {  // 确保不处理空字符串
                        const span = document.createElement('span');
                        span.textContent = item;
                        cell.appendChild(span);

                        const br = document.createElement('br');
                        cell.appendChild(br);  // 在每个 span 后添加换行
                    }
                });
            });
        } else {
            // 其他信息的处理逻辑保持不变
            ['year', 'month', 'day', 'hour'].forEach(time => {
                const cell = row.insertCell();
                cell.classList.add('center');

                const timeIndex = { year: 0, month: 1, day: 2, hour: 3 }[time];
                let items = bazi_info[key][timeIndex]; 

                if (key === 'na_yin' || key === 'day_cs') {
                    cell.textContent = items;
                    applyColorStyles(cell, items);
                } 
                else if(key === 'bazi') { // 特殊处理干支信息
                  // 分别获取天干和地支
                  const tianGan = items[0]; 
                  const diZhi = items[1]; 
      
                  const tgSpan = document.createElement('span');
                  tgSpan.textContent = tianGan;
                  tgSpan.className = 'ganzhi-text'; 
                  applyColorStyles(tgSpan, tianGan); 
                  cell.appendChild(tgSpan);
      
                  const br = document.createElement('br');
                  cell.appendChild(br); 
      
                  const dzSpan = document.createElement('span');
                  dzSpan.textContent = diZhi;
                  dzSpan.className = 'ganzhi-text'; 
                  applyColorStyles(dzSpan, diZhi); 
                  cell.appendChild(dzSpan);
              } 
                else {
                    items.split('|').forEach(item => {
                    const span = document.createElement('span');
                    span.textContent = item;
                    applyColorStyles(span, item);
                    cell.appendChild(span);

                    const br = document.createElement('br');
                    cell.appendChild(br);
                    });
                }
            });
        }
      });
  

        // 设置五行颜色
        function applyColorStyles(cell, text) {
          if (text.includes("木") || text.includes("甲") || text.includes("乙") || text.includes("寅") || text.includes("卯")) {
            cell.classList.add('mu-text');
        } else if (text.includes("火") || text.includes("丙") || text.includes("丁") || text.includes("巳") || text.includes("午")) {
            cell.classList.add('huo-text');
        } else if (text.includes("土") || text.includes("戊") || text.includes("己") || text.includes("丑") || text.includes("辰") || text.includes("未") || text.includes("戌") ) {
            cell.classList.add('tu-text')
        } else if (text.includes("金") || text.includes("庚") || text.includes("辛") || text.includes("申") || text.includes("酉")) {
            cell.classList.add('jin-text');
        } else if (text.includes("水") || text.includes("壬") || text.includes("癸") || text.includes("子") || text.includes("亥")) {
            cell.classList.add('shui-text');
        }
            
        }
    });

//点击保存图片
// function captureTable() {
//   const content = document.getElementById('bazi_content');
//   html2canvas(content).then(canvas => {
//       const link = document.createElement('a');
//       link.download = 'bazi_info.png';
//       link.href = canvas.toDataURL('image/png');
//       link.click(); 
//   });
// }

function captureTable() {
  const content = document.getElementById('bazi_content');
  html2canvas(content).then(canvas => {
    var imageData = canvas.toDataURL('image/png');  // 获取图片的Base64编码
    sendImageToServer(imageData);  // 发送到后端
  });
}

function sendImageToServer(data) {
  fetch('http://127.0.0.1:50002/upload-image', {  // 假设 '/upload-image' 是后端处理图片的API
      method: 'POST',
      headers: {
          'Content-Type': 'application/json'
      },
      body: JSON.stringify({ image: data })
  })
  .then(response => response.json())
  .then(data => console.log('Success:', data))
  .catch((error) => console.error('Error:', error));
}
